import datetime
import hashlib
from tokenize import group
from data import config
from aiogram import types
from aiogram.dispatcher import FSMContext
from loader import dp, bot
from keyboards.inline.menu_button import *
from keyboards.inline.main_inline import *
from utils.db_api.database import *
from django.core.files.base import ContentFile
from aiogram.types import InlineQuery, \
    InputTextMessageContent, InlineQueryResultArticle, ChosenInlineResult
from aiogram.dispatcher.filters.builtin import CommandStart
import random
import requests
import re


def isValid(s):
    Pattern = re.compile("(0|91)?[7-9][0-9]{9}")
    return Pattern.match(s)


def generateOTP():
    return random.randint(111111, 999999)


username = "zoneagency"
password = "j2e4AEFs84"

def send_sms(otp, phone):
    username = 'foodline'
    password = 'JvYkp44)-J&9'
    sms_data = {
        "messages":[{"recipient":f"{phone}","message-id":"abc000000003","sms":{"originator": "3700","content": {"text": f"Sizning Dargoh o'quv platformasida ro'yxatdan o'tish kodingiz: {otp}"}}}]}
    url = "http://91.204.239.44/broker-api/send"
    res = requests.post(url=url, headers={}, auth=(username, password), json=sms_data)


# @dp.message_handler(lambda message: message.text in ["üè† Asosiy menyu", "üè† Main menu", "üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"], state='*')
# async def go_home(message: types.Message, state: FSMContext):
#     lang = await get_lang(message.from_user.id)
#     markup = await user_menu(lang)
#     if lang == "lat":
#         await message.answer("Botimizga xush kelibsiz. Iltimos kerakli bo'limni tanlang üëá", reply_markup=markup)
#     elif lang == "ru":
#         await message.answer("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –±–æ—Ç. –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ªüëá", reply_markup=markup)
#     elif lang == "en":
#         await message.answer("Welcome to our bot. Please select the desired section üëá", reply_markup=markup)
#     await state.set_state("get_command")
 

@dp.message_handler(CommandStart(), state='*')
async def bot_start(message: types.Message, state: FSMContext):
    args = message.get_args()
    if isValid(args):
        user = await get_user_by_phone(args)
        lang = user.lang
        cource = await get_cource_last()
        markup = await user_menu("lat")
        url = await bot.create_chat_invite_link(chat_id=cource.channel, member_limit=1)
        await message.answer(f"‚úîÔ∏è Buyurtma muvaffaqiyatli amalga oshirildi. \nKanaldan foydalanish uchun link:\n{url.invite_link} \nIltimos kerakli bo'limni tanlang üëá", reply_markup=markup)
        await state.set_state("get_command")
    else:
        user = await get_user(message.from_id)
        if user is not None:
            lang = user.lang
            if user.phone:
                markup = await user_menu(lang)
                if lang == "lat":
                    await message.answer("Botimizga xush kelibsiz. Iltimos kerakli bo'limni tanlang üëá", reply_markup=markup)
                elif lang == "kril":
                    await message.answer("–ë–æ—Ç–∏–º–∏–∑–≥–∞ —Ö—É—à –∫–µ–ª–∏–±—Å–∏–∑. –ò–ª—Ç–∏–º–æ—Å –∫–µ—Ä–∞–∫–ª–∏ –±—û–ª–∏–º–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
                await state.set_state("get_command")
            else:
                markup = await phone_keyboard(lang)
                if lang == "lat":
                    await message.answer("Telefon raqamingizni ulashing, yoki <b>998YYxxxxxxx</b> tarzida jo'nating", reply_markup=markup)
                if lang == "kril":
                    await message.answer("–¢–µ–ª–µ—Ñ–æ–Ω —Ä–∞“õ–∞–º–∏–Ω–≥–∏–∑–Ω–∏ –∂—û–Ω–∞—Ç–∏–Ω–≥, —ë–∫–∏ <b>998YYxxxxxxx</b> —Ç–∞—Ä–∑–∏–¥–∞ –∂—û–Ω–∞—Ç–∏–Ω–≥", reply_markup=markup)
                await state.set_state('get_phone')    
        else:
            markup = await language_keyboard()
            await message.answer("Assalomu alaykum DargahEdu Botiga xush kelibsiz. Iltimos kerakli alifboni tanlang", reply_markup=markup)
            await state.set_state('get_lang')


@dp.message_handler(state="get_lang")
async def get_language(message: types.Message, state: FSMContext):
    if message.text == "üá∫üáø O'zbek tili(Lotin)":
        user = await add_user(user_id=message.from_user.id, lang="lat")
        markup = await phone_keyboard(user.lang)
        await message.answer("Telefon raqamingizni ulashing, yoki <b>998YYxxxxxxx</b> tarzida jo'nating", reply_markup=markup)
        await state.set_state('get_phone')
    if message.text == "üá∫üáø –é–∑–±–µ–∫ —Ç–∏–ª–∏(–ö–∏—Ä–∏–ª)":
        user = await add_user(user_id=message.from_user.id, lang="kril")
        markup = await phone_keyboard(user.lang)
        await message.answer("–¢–µ–ª–µ—Ñ–æ–Ω —Ä–∞“õ–∞–º–∏–Ω–≥–∏–∑–Ω–∏ –∂—û–Ω–∞—Ç–∏–Ω–≥, —ë–∫–∏ <b>998YYxxxxxxx</b> —Ç–∞—Ä–∑–∏–¥–∞ –∂—û–Ω–∞—Ç–∏–Ω–≥", reply_markup=markup)
        await state.set_state('get_phone')


@dp.message_handler(lambda message: message.text in ["‚¨ÖÔ∏èÔ∏è Ortga", "‚¨ÖÔ∏èÔ∏è –û—Ä—Ç–≥–∞"], state="get_phone")
async def get_phone(message: types.Message, state: FSMContext):
    lang = await get_lang(message.from_user.id)
    markup = await language_keyboard()
    await message.answer("Assalomu alaykum DargahEdu Botiga xush kelibsiz. Iltimos siz uchun qulay bo'lgan kiritish usulini tanlang", reply_markup=markup)
    await state.set_state('get_lang')


@dp.message_handler(content_types=types.ContentTypes.TEXT, state="get_phone")
async def get_phone(message: types.Message, state: FSMContext):
    lang = await get_lang(message.from_user.id)
    if isValid(message.text):
        phone = message.text
        user = await get_user(message.from_user.id)
        user.new_phone = phone
        otp = generateOTP()
        user.otp = otp
        user.save()
        send_sms(phone=phone, otp=otp)
        lang = await get_lang(message.from_user.id)
        keyboard = await back_keyboard(lang)
        if lang == "lat":
            await message.answer(text=f"<b>{user.new_phone}</b> raqamiga yuborilgan tasdiqlash kodini kiriting", parse_mode='HTML', reply_markup=keyboard)
        if lang == "kril":
            await message.answer(text=f"<b>{user.new_phone}</b> —Ä–∞“õ–∞–º–∏–≥–∞ —é–±–æ—Ä–∏–ª–≥–∞–Ω —Ç–∞—Å–¥–∏“õ–ª–∞—à –∫–æ–¥–∏–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥.", parse_mode='HTML', reply_markup=keyboard)
        await state.set_state("get_otp")
    else:
        markup = await phone_keyboard(lang)
        if lang == "lat":
            await message.answer("Telefon raqamingizni ulashing, yoki <b>998YYxxxxxxx</b> tarzida jo'nating", reply_markup=markup)
        if lang == "kril":
            await message.answer("–¢–µ–ª–µ—Ñ–æ–Ω —Ä–∞“õ–∞–º–∏–Ω–≥–∏–∑–Ω–∏ –∂—û–Ω–∞—Ç–∏–Ω–≥, —ë–∫–∏ <b>998YYxxxxxxx</b> —Ç–∞—Ä–∑–∏–¥–∞ –∂—û–Ω–∞—Ç–∏–Ω–≥", reply_markup=markup)
        await state.set_state('get_phone')    
        


@dp.message_handler(content_types=types.ContentTypes.CONTACT, state="get_phone")
async def get_phone(message: types.Message, state: FSMContext):
    if message.contact:
        phone = message.contact.phone_number[0:]
        user = await get_user(message.from_user.id)
        user.new_phone = phone
        otp = generateOTP()
        user.otp = otp
        user.save()
        send_sms(phone=phone, otp=otp)
        lang = await get_lang(message.from_user.id)
        keyboard = await back_keyboard(lang)
        if lang == "lat":
            await message.answer(text=f"<b>{user.new_phone}</b> raqamiga yuborilgan tasdiqlash kodini kiriting", parse_mode='HTML', reply_markup=keyboard)
        if lang == "kril":
            await message.answer(text=f"<b>{user.new_phone}</b> —Ä–∞“õ–∞–º–∏–≥–∞ —é–±–æ—Ä–∏–ª–≥–∞–Ω —Ç–∞—Å–¥–∏“õ–ª–∞—à –∫–æ–¥–∏–Ω–∏ –∫–∏—Ä–∏—Ç–∏–Ω–≥.", parse_mode='HTML', reply_markup=keyboard)
        await state.set_state("get_otp")


@dp.message_handler(lambda message: message.text in ["‚¨ÖÔ∏èÔ∏è Ortga", "‚¨ÖÔ∏èÔ∏è –û—Ä—Ç–≥–∞"], state="get_otp")
async def get_back_otp(message: types.Message, state: FSMContext):
    user = await get_user(message.from_user.id)
    lang = user.lang
    markup = await phone_keyboard(lang)
    if lang == "lat":
        await message.answer("Telefon raqamingizni jo'nating", reply_markup=markup)
    elif lang == "kril":
        await message.answer("–¢–µ–ª–µ—Ñ–æ–Ω —Ä–∞“õ–∞–º–∏–Ω–≥–∏–∑–Ω–∏ –∂—û–Ω–∞—Ç–∏–Ω–≥", reply_markup=markup)
    await state.set_state("get_phone")            

    
@dp.message_handler(content_types=types.ContentTypes.TEXT, state="get_otp")
async def get_phone(message: types.Message, state: FSMContext):
    user = await get_user(message.from_user.id)
    lang = user.lang
    if message.text == user.otp:
        user.phone = user.new_phone
        user.save()
        markup = await user_menu(lang)
        if lang == "lat":
            await message.answer("Botimizga xush kelibsiz. Iltimos kerakli bo'limni tanlang üëá", reply_markup=markup)
        elif lang == "kril":
            await message.answer("–ë–æ—Ç–∏–º–∏–∑–≥–∞ —Ö—É—à –∫–µ–ª–∏–±—Å–∏–∑. –ò–ª—Ç–∏–º–æ—Å –∫–µ—Ä–∞–∫–ª–∏ –±—û–ª–∏–º–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
        await state.set_state("get_command")
    else:
        lang = await get_lang(message.from_user.id)
        markup = await back_keyboard(lang)
        if lang == "lat":
            await message.answer("‚ö†Ô∏è Yuborilgan tasdiqlash kodi xato. Qayta urinib ko'ring", reply_markup=markup)
        elif lang == "kril":
            await message.answer("‚ö†Ô∏è –Æ–±–æ—Ä–∏–ª–≥–∞–Ω —Ç–∞—Å–¥–∏“õ–ª–∞—à –∫–æ–¥–∏ —Ö–∞—Ç–æ. “ö–∞–π—Ç–∞ —É—Ä–∏–Ω–∏–± –∫—û—Ä–∏–Ω–≥", reply_markup=markup)
        await state.set_state("get_otp")
        

@dp.message_handler(lambda message: message.text in ["üìö Oila kursi haqida", "üìö –û–∏–ª–∞ –∫—É—Ä—Å–∏ “≥–∞“õ–∏–¥–∞", "‚úçÔ∏è Fikr qoldirish", "‚úçÔ∏è –§–∏–∫—Ä “õ–æ–ª–¥–∏—Ä–∏—à"], state="get_command")
async def get_user_command(message: types.Message, state: FSMContext):
    lang = await get_lang(message.from_user.id)
    command = message.text
    message_id = int(message.message_id) + 1
    if command in ["üìö Oila kursi haqida", "üìö –û–∏–ª–∞ –∫—É—Ä—Å–∏ “≥–∞“õ–∏–¥–∞"]:
        course = await get_cource_by_name("Oila kursi")
        if course is not None:
            await state.update_data(cource_id=course.id)
            markup = await cource_buy_keyboard(lang)
            await message.answer(text='.', reply_markup=markup)
            await bot.delete_message(chat_id=message.from_user.id, message_id=message_id)
            test_keyboard = await test_cource(lang)
            if lang == "lat":
                await message.answer(text=f"Kurs Nomi{course.name_lat}\n\nKurs narxi: {course.price}\n\n{course.description_lat}\n\n", reply_markup=test_keyboard)
            if lang == "kril":
                await message.answer(text=f"–ö—É—Ä—Å –ù–æ–º–∏:   {course.name_kril}\n\n–ö—É—Ä—Å –Ω–∞—Ä—Ö–∏: {course.price}\n\n{course.description_kril}\n\n", reply_markup=test_keyboard)
            await state.set_state("buy_cource")         
    if message.text in ["‚úçÔ∏è Fikr qoldirish", "‚úçÔ∏è –§–∏–∫—Ä “õ–æ–ª–¥–∏—Ä–∏—à"]:
        markup = await back_keyboard(lang)
        if lang == "lat":
            await message.answer(text=f"Fikrlaringizni qoldiring ‚úçÔ∏è", reply_markup=markup)
        if lang == "kril":
            await message.answer(text=f"–§–∏–∫—Ä–ª–∞—Ä–∏–Ω–≥–∏–∑–Ω–∏ “õ–æ–ª–¥–∏—Ä–∏–Ω–≥ ‚úçÔ∏è", reply_markup=markup)
        await state.set_state("get_feedback")

@dp.message_handler(state="get_feedback")
async def get_feedback_message(message: types.Message, state:FSMContext):
    if "‚¨ÖÔ∏èÔ∏èÔ∏è" in message.text:
        lang = await get_lang(message.from_user.id)
        markup = await user_menu(lang)
        if lang == "lat":
            await message.answer("Botimizga xush kelibsiz. Iltimos kerakli bo'limni tanlang üëá", reply_markup=markup)
        elif lang == "kril":
            await message.answer("–ë–æ—Ç–∏–º–∏–∑–≥–∞ —Ö—É—à –∫–µ–ª–∏–±—Å–∏–∑. –ò–ª—Ç–∏–º–æ—Å –∫–µ—Ä–∞–∫–ª–∏ –±—û–ª–∏–º–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
        await state.set_state("get_command")
    else:
        await message.forward(chat_id=-882055933)
        lang = await get_lang(message.from_user.id)
        markup = await user_menu(lang)
        if lang == "lat":
            await message.answer("Fikr-mulohazangiz uchun tashakkur!", reply_markup=markup)
        elif lang == "kril":
            await message.answer("–§–∏–∫—Ä-–º—É–ª–æ“≥–∞–∑–∞–Ω–≥–∏–∑ —É—á—É–Ω —Ç–∞—à–∞–∫–∫—É—Ä!", reply_markup=markup)
        await state.set_state("get_command")


@dp.message_handler(content_types=types.ContentTypes.TEXT, state="buy_cource")
async def get_course(message: types.Message, state: FSMContext):
    lang = await get_lang(message.from_user.id)
    user = await get_user(message.from_user.id)
    if "‚¨ÖÔ∏èÔ∏è" in message.text:
        markup = await user_menu(lang)
        if lang == "lat":
            await message.answer("Botimizga xush kelibsiz. Iltimos kerakli bo'limni tanlang üëá", reply_markup=markup)
        elif lang == "kril":
            await message.answer("–ë–æ—Ç–∏–º–∏–∑–≥–∞ —Ö—É—à –∫–µ–ª–∏–±—Å–∏–∑. –ò–ª—Ç–∏–º–æ—Å –∫–µ—Ä–∞–∫–ª–∏ –±—û–ª–∏–º–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
        await state.set_state("get_command")
    if message.text in ["üõí –°–æ—Ç–∏–± –æ–ª–∏—à", "üõí Sotib olish"]:
        markup = await order_type_keyboard(lang)
        if lang == "lat":
            await message.answer("üí∏ To'lov turini tanlang üëá", reply_markup=markup)
        elif lang == "kril":
            await message.answer("üí∏ –¢—û–ª–æ–≤ —Ç—É—Ä–∏–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
        await state.set_state("pay_type")


@dp.message_handler(content_types=types.ContentTypes.TEXT, state="pay_type")
async def get_course(message: types.Message, state: FSMContext):
    lang = await get_lang(message.from_user.id)
    user = await get_user(message.from_user.id)
    if message.text in ["‚¨ÖÔ∏èÔ∏è Ortga", "‚¨ÖÔ∏èÔ∏è –û—Ä—Ç–≥–∞"]:
        data = await state.get_data()
        cource_id  = data["cource_id"]
        course = await get_cource(cource_id)
        markup = await cource_buy_keyboard(lang)
        if lang == "lat":
            await message.answer(text=f"Kurs Nomi{course.name_lat}\n\nKurs narxi: {course.price}\n\n{course.description_lat}\n\nBepul tanishuv: {course.test_channel}", reply_markup=markup)
        if lang == "kril":
            await message.answer(text=f"–ö—É—Ä—Å –ù–æ–º–∏:   {course.name_kril}\n\n–ö—É—Ä—Å –Ω–∞—Ä—Ö–∏: {course.price}\n\n{course.description_kril}\n\n–ë–µ–ø—É–ª —Ç–∞–Ω–∏—à—É–≤: {course.test_channel}", reply_markup=markup)
        await state.set_state("buy_cource")         
    if message.text in ["üîÇ –ë—û–ª–∏–± —Ç—û–ª–∞—à", "üîÇ Bo'lib to'lash"]:
        markup = await order_type_keyboard(lang)
        if lang == "lat":
            await message.answer("‚ÑπÔ∏è Ushbu qism ustida ishlar olib borilmoqda üëá", reply_markup=markup)
        elif lang == "kril":
            await message.answer("‚ÑπÔ∏è –£—à–±—É “õ–∏—Å–º —É—Å—Ç–∏–¥–∞ –∏—à–ª–∞—Ä –æ–ª–∏–± –±–æ—Ä–∏–ª–º–æ“õ–¥–∞ üëá", reply_markup=markup)
    if message.text in ["‚ùáÔ∏è –ë–∏—Ä –º–∞—Ä—Ç–∞–¥–∞ —Ç—û–ª–æ–≤", "‚ùáÔ∏è Bir martada to'lov"]:
        markup = await pay_method(lang)
        if lang == "lat":
            await message.answer("To'lov usulini tanlang üëá", reply_markup=markup)
        elif lang == "kril":
            await message.answer("–¢—û–ª–æ–≤ —É—Å—É–ª–∏–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
        await state.set_state("get_payment_method")


@dp.message_handler(content_types=types.ContentTypes.TEXT, state="get_payment_method")
async def get_course(message: types.Message, state: FSMContext):
    lang = await get_lang(message.from_user.id)
    user = await get_user(message.from_user.id)
    if message.text in ["‚¨ÖÔ∏èÔ∏è Ortga", "‚¨ÖÔ∏èÔ∏è –û—Ä—Ç–≥–∞"]:
        markup = await order_type_keyboard(lang)
        if lang == "lat":
            await message.answer("üí∏ To'lov turini tanlang üëá", reply_markup=markup)
        elif lang == "kril":
            await message.answer("üí∏ –¢—û–ª–æ–≤ —Ç—É—Ä–∏–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
        await state.set_state("pay_type")
    elif message.text in ["üîµ Click", "üü¢ Payme"]:
        prices = []
        markup = await back_keyboard(lang)
        await message.answer(text='.', reply_markup=markup)
        data = await state.get_data()
        cource_id  = data["cource_id"]
        course = await get_cource(cource_id)
        message_id = message.message_id + 2
        await state.update_data(message_id=message_id)
        if message.text == "üîµ Click":
            photo = 'https://click.uz/click/images/clickog.png'
            token = '398062629:TEST:999999999_F91D8F69C042267444B74CC0B3C747757EB0E065'
        elif message.text == "üü¢ Payme":
            photo = "https://cdn.paycom.uz/documentation_assets/payme_01.png"
            token = '371317599:TEST:1672069604730'
        texts = []
        if lang == "lat":
            texts = ["Kurs uchun to'lov"]
            prices.append(
                types.LabeledPrice(label=f"{course.name_lat}", amount=int(course.price) * 100))
        if lang == "kril":
            texts = ["–ö—É—Ä—Å —É—á—É–Ω —Ç—û–ª–æ–≤"]
            prices.append(
                types.LabeledPrice(label=f"{course.name_kril}", amount=int(course.price) * 100))
        await bot.send_invoice(chat_id=message.from_user.id, title=f'Dargah Edu',
                               description=f'{texts[0]}',
                               provider_token=token,
                               currency='UZS',
                               photo_url=photo,
                               photo_height=512,  # !=0/None or picture won't be shown
                               photo_width=512,
                               photo_size=512,
                               prices=prices,
                               start_parameter='hz-wto-tut',
                               payload="Payload",
                               )
        await state.set_state("payment")  
   

@dp.message_handler(state="payment")
async def get_payment(message: types.Message, state: FSMContext):
    lang = await get_lang(message.from_user.id)
    if "‚¨ÖÔ∏è" in message.text:
        data = await state.get_data()
        message_id = data['message_id']
        await bot.delete_message(message_id=message_id, chat_id=message.from_id)
        data = await state.get_data()
        cource_id  = data["cource_id"]
        cource = await get_cource(cource_id)
        markup = await pay_method(lang)
        if lang == "lat":
            await message.answer("To'lov usulini tanlang üëá", reply_markup=markup)
        elif lang == "kril":
            await message.answer("–¢—û–ª–æ–≤ —É—Å—É–ª–∏–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
        await state.set_state("get_payment_method")
                

@dp.pre_checkout_query_handler(lambda query: True, state='payment')
async def checkout(pre_checkout_query: types.PreCheckoutQuery):
    await bot.answer_pre_checkout_query(pre_checkout_query.id, ok=True)


@dp.message_handler(content_types=types.ContentTypes.SUCCESSFUL_PAYMENT, state="payment")
async def got_payment(message: types.Message, state: FSMContext):
    lang = await get_lang(message.from_id)
    markup = await user_menu(lang)
    data = await state.get_data()
    message_id = data['message_id']
    await bot.delete_message(message_id=message_id, chat_id=message.from_id)
    data = await state.get_data()
    cource_id  = data["cource_id"]
    cource = await get_cource(cource_id)
    url = await bot.create_chat_invite_link(chat_id=cource.channel, member_limit=1)

    if lang == "lat":
        await message.answer(f"‚úîÔ∏è Buyurtma muvaffaqiyatli amalga oshirildi. \nKanaldan foydalanish uchun link:\n{url.invite_link} \nIltimos kerakli bo'limni tanlang üëá", reply_markup=markup)
    elif lang == "kril":
        await message.answer(f"‚úîÔ∏è –ë—É—é—Ä—Ç–º–∞ –º—É–≤–∞—Ñ—Ñ–∞“õ–∏—è—Ç–ª–∏ –∞–º–∞–ª–≥–∞ –æ—à–∏—Ä–∏–ª–¥–∏. \–Ω–ö–∞–Ω–∞–ª–¥–∞–Ω —Ñ–æ–π–¥–∞–ª–∞–Ω–∏—à —É—á—É–Ω –ª–∏–Ω–∫:\–Ω{url.invite_link} \–Ω–ò–ª—Ç–∏–º–æ—Å –∫–µ—Ä–∞–∫–ª–∏ –±—û–ª–∏–º–Ω–∏ —Ç–∞–Ω–ª–∞–Ω–≥ üëá", reply_markup=markup)
    await state.set_state("get_command")
